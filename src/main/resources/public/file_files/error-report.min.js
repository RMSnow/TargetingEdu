OT2.ErrorReport=function(){function t(e){return"undefined"==typeof USER.uid?(OT2.Global.initLogin(),null):this instanceof t?(this.Event=new OT2.Event,this.qid=e,this.$el=null,this.$form=null,void this.init()):new t(e)}var e=_.template(OT2.Util.Template().get("errorReport"));return t.prototype={init:function(){this.render(),this.bindEvent(),this.show()},render:function(){this.$el=$(e({qid:this.qid})),this.$form=this.$el.find("form")},checkForm:function(){var t=this.$form.find("textarea").val(),e=this.$form.find(".warn");return $.trim(t).length<=0?(e.text("纠错内容不能为空！").show(),!1):(e.hide(),!0)},bindEvent:function(){var t=this;this.$form.on("submit",function(){return t.checkForm(),!1}),this.Event.subscribe("form:submit",function(e){var i=t.$form.serializeArray();$.post("/question/error-report",i,function(t){0==t.errCode?OT2.Util.alert("试题纠错成功"):OT2.Util.alert(t.message),e.close()},"json")})},destruct:function(){this.$form.off(),this.$el.remove()},show:function(){var t=this,e=dialog({title:"试题纠错",content:t.$el.get(0),okValue:"确定",ok:function(){return t.Event.publish("form:submit",this),this.title("请稍等，正在提交…"),!1},fixed:!0,cancelValue:"取消",cancel:function(){e.close().remove(),t.destruct()}});e.addEventListener("show",function(){var e=this;t.Event.subscribe("form:complete",function(){e.title("试题纠错")})}),$.get("/question/is-in-error-report",{qid:t.qid},function(t){0==t.errCode?e.showModal():OT2.Util.alert(t.message)})}},t}(),OT2.QCollect=function(t,e,i){if("undefined"==typeof USER.uid)return OT2.Global.initLogin(),!0;var n=t.innerHTML.indexOf("取消收藏")>-1||t.innerHTML.indexOf("已收藏")>-1;t.innerHTML=n?'<i class="icona-shoucangs"></i>收藏':'<i class="icona-quxiaosc"></i>取消收藏';var o=n?"试题取消收藏！":"试题收藏成功！";$.post("/question/collect",{question_id:e},function(t){OT2.Util.alert(o)},"json"),"undefined"!=typeof i&&$(t).parents(i).fadeOut(function(){$(this).remove()})},OT2.PaperAnalysis={url:"",data:null,getContent:function(t){var e=this;$.get(this.url,function(i){0==i.errCode&&(e.data=i.data,data=e.template(i.data),t.call(e,data))})},template:function(t){var e=_.template(OT2.Util.Template().get("dialog-analysis"));return e(t)},show:function(t){var e=this;this.url=t,this.getContent(function(t){var i=dialog({title:"试卷分析",content:t,width:800,fixed:!1,onshow:function(){e.renderChart("#J_chart_container")}});i.showModal()})},show1:function(t){var e=this;e.data=t,t=e.template(t);var i=dialog({title:"试卷分析",content:t,width:800,fixed:!1,onshow:function(){e.renderChart("#J_chart_container")}});i.showModal()},renderChart:function(t){$(t).highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},credits:{enabled:!1},title:{text:!1},tooltip:{formatter:function(){return this.key+"<br/>占比"+this.y+"%"}},legend:{align:"right",verticalAlign:"middle",x:0,y:0,layout:"vertical",itemMarginBottom:15},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return"难度占比"+this.y+"%"},style:{fontWeight:"normal"}},showInLegend:!0}},series:[{type:"pie",name:"试题难度结构分析",data:[{name:"困难",color:"#73E22B",y:this.data.grid3[2]},{name:"普通",color:"#FBBD38",y:this.data.grid3[1]},{name:"容易",color:"#48CAEF",y:this.data.grid3[0]}]}]})}};